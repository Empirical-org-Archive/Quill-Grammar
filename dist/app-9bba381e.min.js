!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({"./src/scripts/app/app.module.js":[function(require){"use strict";angular.module("quill-grammar",[require("./core/core.module.js").name,require("./index/index.module.js").name,require("./cms/cms.module.js").name,require("./activities/module.js").name,require("./layout/layout.module.js").name]).config(require("./app.config.js"))},{"./activities/module.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/module.js","./app.config.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/app.config.js","./cms/cms.module.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/cms/cms.module.js","./core/core.module.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/core/core.module.js","./index/index.module.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/index/index.module.js","./layout/layout.module.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/layout/layout.module.js"}],"/home/will/Clients/Quill-Grammar/.tmp/config.js":[function(require,module){module.exports=angular.module("quill-grammar.config",[]).constant("environment","production").constant("firebaseUrl","https://quillgrammar.firebaseio.com/")},{}],"/home/will/Clients/Quill-Grammar/.tmp/templates.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.templates",[]).run(["$templateCache",function($templateCache){$templateCache.put("index.html",'<!DOCTYPE html><html ng-app="quill-grammar" ng-strict-di><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title></title><base href="/"></head><body><ui-view></ui-view></body></html>'),$templateCache.put("cms.html",'<div class="grammar-cms"><grammar-cms-categories-new></grammar-cms-categories-new><grammar-cms-categories-list></grammar-cms-categories-list></div>'),$templateCache.put("layout.html","<ui-view></ui-view>"),$templateCache.put("activities.html",'<h2>Activities</h2>\n<a ui-sref="sentences.list()">Sentence Writing</a>\n<ui-view></ui-view>\n'),$templateCache.put("index.html",'<button ng-show="showNextQuestion" ng-click="nextQuestion()">Next Question</button>\n<grammar-rule-question rule-question="currentRuleQuestion">\n</grammar-rule-question>\n<button ng-show="showPreviousQuestion" ng-click="previousQuestion()">Previous Question</button>\n'),$templateCache.put("categories.list.html",'<ul>\n  <li ng-repeat="category in categories">\n    <grammar-cms-category category="category"></grammar-cms-category>\n  <li>\n</ul>\n'),$templateCache.put("categories.new.html",'<button ng-click=\'toggleCategoryModal()\'>New Category</button>\n<grammar-cms-modal-dialog\n  show=\'showNewCategoryModal\'\n  action=\'saveCategory\'>\n  <form validate>\n    <label for="category">Category Title</label>\n    <input type="text" name="category" placeholder="Category Name" ng-model="category.title" />\n    <input type="submit" ng-click="$parent.doAction(category)" value="Add Category" />\n  </form>\n</grammar-cms-modal-dialog>\n'),$templateCache.put("category.edit.html",'<ul>\n  <li><img src="assets/images/newrule.png" ng-click=\'newRule()\' alt="Add Rule" title="Add Rule"/></li>\n  <li><img src="assets/images/delete.png" ng-click="showDeleteCategory()" alt="Delete Category" title="Delete Category"/></li>\n  <li><img src="assets/images/edit.png" ng-click="editCategory(category)" alt="Edit Category" title="Edit Category"/></li>\n</ul>\n\n<grammar-cms-modal-dialog\n  show=\'showNewRuleModal\'\n  action=\'saveRule\'>\n  <form validate ng-submit="$parent.doAction(category, rule)">\n    <p>New Rule for {{category.title}}</p>\n    <input type="text" name="rule" placeholder="Rule Name" ng-model="rule.title" required/>\n    <input type="text" name="description" placeholder="Rule Description"\n      ng-model="rule.description" required/>\n    <input type="text" name="classification" placeholder="Rule Classification"\n      ng-model="rule.classification" required/>\n    <input type="submit" value="Add Rule" />\n  </form>\n</grammar-cms-modal-dialog>\n\n<grammar-cms-delete-modal-dialog show=\'showDeleteCategoryModal\' on-delete="deleteCategory" item="category">\n  <p>Deleting this will delete all rules and practice questions in this category.</p>\n</grammar-cms-delete-modal-dialog>\n'),$templateCache.put("category.show.html",'<div class="grammar-cms-section">\n  <div class="grammar-cms-heading">\n    <h2>{{category.title}}</h2>\n    <button\n      ng-show="!category.resolvedRules"\n      ng-click="showRules(category)"\n    >Show Rules</button>\n  <p>{{category.error}}</p>\n  </div>\n  <grammar-cms-category-panel\n    category="category"\n    class="grammar-cms-panel">\n  </grammar-cms-category-panel>\n</div>\n<div ng-show="category.resolvedRules">\n  <grammar-cms-rule\n    ng-show="rule"\n    rule="rule"\n    ng-repeat="rule in category.resolvedRules">\n  </grammar-cms-rule>\n  <button ng-click="hideRules(category)">Hide Rules</button\n</div>\n'),$templateCache.put("deleteModal.html",'<div class="modal" ng-show="show">\n  <input class="modal-state" type="checkbox" ng-checked="show"/>\n  <div class="modal-window">\n    <div class="modal-inner">\n      <label class="modal-close" ng-click="hideModal()"></label>\n      <p>Delete {{item.title}}?<p>\n      <div ng-transclude></div>\n      <button ng-click="_onDelete(item)">Delete</button>\n      <p class="error" ng-show="error">{{error}}</p>\n    </div>\n  </div>\n</div>\n'),$templateCache.put("modal.html",'<div class="modal" ng-show="show">\n  <input class="modal-state" type="checkbox" ng-checked="show"/>\n  <div class="modal-window">\n    <div class="modal-inner">\n      <label class="modal-close" ng-click="hideModal()"></label>\n      <div ng-transclude></div>\n    </div>\n  </div>\n</div>\n'),$templateCache.put("question.edit.html",'<ul>\n  <li><span class="spacer"></span></li>\n  <li><img src="assets/images/delete.png" ng-click="showDeleteRuleQuestion()" alt="Delete Rule Question" title="Delete Rule Question"/></li>\n  <li><img src="assets/images/edit.png" ng-click="editRuleQuestion(question)" alt="Edit Rule Question"/title="Edit Rule Question"></li>\n</ul>\n\n<grammar-cms-delete-modal-dialog show=\'showDeleteRuleQuestionModal\' on-delete="deleteRuleQuestion" item="question">\n  <p>{{question.prompt}}</p>\n</grammar-cms-delete-modal-dialog>\n'),$templateCache.put("question.show.html",'<div class="grammar-cms-section">\n  <div class="grammar-cms-heading">\n    <p>{{question.prompt}}</p>\n  </div>\n  <grammar-cms-rule-question-panel class="grammar-cms-panel" question="question"></grammar-cms-rule-question-panel>\n</div>\n'),$templateCache.put("rule.edit.html",'<ul>\n  <li><img src="assets/images/newrulequestion.png" ng-click=\'showRuleQuestionModal()\' alt="Add Rule Question" title="Add Rule Question"/></li>\n  <li><img src="assets/images/delete.png" ng-click="showDeleteRule()" alt="Delete Rule" title="Delete Rule"/></li>\n  <li><img src="assets/images/edit.png" ng-click="editRule(rule)" alt="Edit Rule" title="Edit Rule"/></li>\n</ul>\n\n<grammar-cms-modal-dialog\n  show=\'showNewRuleQuestionModal\'\n  action=\'saveRuleQuestion\'>\n  <form validate ng-submit=\'$parent.doAction(rule, question)\'>\n    <p>Adding rule question for rule "{{rule.title}}"</p>\n    <input required type="text" name="prompt" placeholder="Prompt"\n    ng-model="question.prompt" />\n    <input type="text" name="hint" placeholder="Hint"\n    ng-model="question.hint" />\n    <p><b>Body</b></p>\n    <ul>\n      <li style="display: block;" ng-repeat="b in question.body">\n        <input type="text" ng-model="b" />\n      </li>\n    </ul>\n    <input type="text" name="body" placeholder="Correct Response"\n    ng-model="question.tempB" />\n    <button type="button" ng-click="addAnswerToBody(question)">\n      Add Correct Response\n    </button>\n    <input required type="text" name="instructions" placeholder="Instructions"\n    ng-model="question.instructions"/>\n    <input type="submit" value="Add Practice Question" />\n  </form>\n</grammar-cms-modal-dialog>\n\n<grammar-cms-delete-modal-dialog show=\'showDeleteRuleModal\' on-delete="deleteRule" item="rule">\n  <p>This will delete all practice questions for this rule.</p>\n</grammar-cms-delete-modal-dialog>\n'),$templateCache.put("rule.show.html",'<div class="grammar-cms-section">\n  <div class="grammar-cms-heading">\n    <h5>{{rule.title}} - {{rule.ruleNumber}}</h5>\n  </div>\n  <grammar-cms-rule-panel class="grammar-cms-panel"\n  rule="rule"></grammar-cms-rule-panel>\n</div>\n\n<ul>\n  <li ng-repeat="question in rule.resolvedRuleQuestions">\n    <grammar-cms-rule-question question="question"></grammar-cms-rule-question>\n  </li>\n</ul>\n'),$templateCache.put("sentences.edit.html",'<label for="sentence.new">Practice Question</label>\n<input type="text" name="sentence.new" placeholder="Name"\n  ng-model="editSentence.title" required/>\n<input type="text" name="sentence.description" placeholder="Description"\nng-model="editSentence.description" required/>\n<select ng-options="flag.title for flag in flags" ng-model="editSentence.flag"\n  placeholder="Flag" required></select>\n<select ng-options="cat.title for cat in availableCategories"\n  ng-model="editSentence.category" required></select>\n<select ng-options="(rule.ruleNumber + \'. \' + rule.title) for rule in availableRules" ng-model="tempRule"></select>\n\n<button ng-click="addRule(editSentence, tempRule)">Add Rule</button>\n\n<ul ng-repeat="rule in editSentence.rules">\n  <li>\n    <h4>{{rule.ruleNumber}}. {{rule.title}}</h4>\n    <p>{{rule.description}}</p>\n    <input type="text"\n       placeholder="Number of Questions from this Rule"\n       ng-model="rule.quantity"/>\n    <button ng-click="removeRule(editSentence, rule)">X Remove</button>\n  </li>\n</ul>\n<div class="error" ng-show="error">\n  <p>{{error}}</p>\n</div>\n\n<button\n    ng-click="submitSentence(\'^.list\', editSentence, true)"\n    ng-show="editSentence.rules.length > 0">\n  Update\n</button>\n'),$templateCache.put("sentences.list.html",'<h2>Sentence Writing</h2>\n<ul ng-repeat="set in sentences">\n  <li><h3>{{set.title}}</h3><a ui-sref="sentences.edit({id: set.$id})">edit</a></li>\n</ul>\n\n<a ui-sref="sentences.new.details()">new</a>\n'),$templateCache.put("sentences.new.details.html",'<form validate ng-submit="nextStep()">\n  <label for="sentence.new">Practice Question</label>\n  <input type="text" name="sentence.new" placeholder="Name"\n    ng-model="newSentence.title" required/>\n  <input type="text" name="sentence.description" placeholder="Description"\n  ng-model="newSentence.description" required/>\n  <select ng-options="flag.title for flag in flags" ng-model="newSentence.flag"\n    placeholder="Flag" required></select>\n  <select ng-options="cat.title for cat in availableCategories"\n    ng-model="newSentence.category" required></select>\n  <button type="submit">Next</button>\n</form>\n'),$templateCache.put("sentences.new.html","<h3>New Sentence Writing</h3>\n<div ui-view></div>\n"),$templateCache.put("sentences.new.questions.html",'<select ng-options="(rule.ruleNumber + \'. \' + rule.title) for rule in availableRules" ng-model="tempRule"></select>\n\n<button ng-click="addRule(newSentence, tempRule)">Add Rule</button>\n\n<ul ng-repeat="rule in newSentence.rules">\n  <li>\n    <h4>{{rule.ruleNumber}}. {{rule.title}}</h4>\n    <p>{{rule.description}}</p>\n    <input type="text"\n       placeholder="Number of Questions from this Rule"\n       ng-model="rule.quantity"/>\n    <button ng-click="removeRule(newSentence, rule)">X Remove</button>\n  </li>\n</ul>\n<div class="error" ng-show="error">\n  <p>{{error}}</p>\n</div>\n\n<button\n    ng-click="submitSentence(\'^.^.list\', newSentence)"\n    ng-show="newSentence.rules.length > 0">\n  Submit\n</button>\n'),$templateCache.put("ruleQuestion.html",'<div class="ruleQuestion">\n  <p ng-bind-html="ruleQuestion.resolvedInstructions | trustedHtml"></p>\n  <p ng-bind-html="ruleQuestion.hint | trustedHtml"></p>\n  <p ng-bind-html="ruleQuestion.prompt | formatPrompt | trustedHtml"></p>\n  <input type="text" ng-model="ruleQuestion.response"/>\n  <button ng-click="checkAnswer()">Check Answer</button>\n  <p ng-show="ruleQuestion.message">{{ruleQuestion.message}}</p>\n</div>\n')}])},{}],"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/config.js":[function(require,module){"use strict";module.exports=["$stateProvider",function($stateProvider){$stateProvider.state("activities",{parent:"app",url:"/activities",templateUrl:"activities.html"})}]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/controller.js":[function(require,module){"use strict";module.exports=["$scope",function(){}]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/module.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.activities",[require("./sentences/module.js").name]).config(require("./config.js")).controller("activities",require("./controller.js"))},{"./config.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/config.js","./controller.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/controller.js","./sentences/module.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/sentences/module.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/sentences/config.js":[function(require,module){"use strict";module.exports=["$stateProvider",function($stateProvider){$stateProvider.state("sentences",{parent:"activities",controller:"SentencesCtrl",url:"/sentences",template:"<div ui-view></div>"}).state("sentences.list",{url:"/list",templateUrl:"sentences.list.html"}).state("sentences.edit",{url:"/edit/:id",require:"^SentencesCtrl",controller:"EditSentenceCtrl",templateUrl:"sentences.edit.html"}).state("sentences.new",{url:"/new",templateUrl:"sentences.new.html"}).state("sentences.new.details",{parent:"sentences.new",url:"/details",templateUrl:"sentences.new.details.html"}).state("sentences.new.questions",{parent:"sentences.new",url:"/questions",templateUrl:"sentences.new.questions.html"})}]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/sentences/controller.js":[function(require,module){"use strict";module.exports=["$scope","CategoryService","$state","RuleService","SentenceWritingService","_","$timeout",function($scope,CategoryService,$state,RuleService,SentenceWritingService,_,$timeout){function clearError(){$scope.error=null}function setError(msg){$scope.error=msg,$timeout(clearError,5e3)}$scope.newSentence={},$scope.flags=[{$id:1,title:"Production"},{$id:2,title:"Beta"}],SentenceWritingService.getAllSentenceWritings().then(function(ss){$scope.sentences=ss}),CategoryService.getCategories().then(function(cats){$scope.availableCategories=cats}),RuleService.getAllRules().then(function(rules){$scope.availableRules=rules}),$scope.nextStep=function(){$state.go("^.questions")},$scope.addRule=function(s,r){try{if(s.rules||(s.rules=[]),_.find(s.rules,r))throw new Error("Cannot have two instances of the same rule "+r.title);r&&s.rules.push(r)}catch(e){setError(e.message)}},$scope.removeRule=function(s,r){s&&(s.rules=_.without(s.rules,r))},$scope.submitSentence=function(stateString,s,edit){function handleResult(){$scope.newSentence={},$state.go(stateString)}function handlerError(e){console.error(e),setError(e.message||e)}try{var allPositiveQuantities=_.every(s.rules,function(r){return Number(r.quantity)>0});if(!allPositiveQuantities)throw new Error("Please make all rules have a quanity greater than zero");var p=null;return p=edit?SentenceWritingService.updateSentenceWriting(s):SentenceWritingService.saveSentenceWriting(s),p.then(handleResult,handlerError)}catch(e){setError(e.message)}}}]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/sentences/editSentence.js":[function(require,module){"use strict";module.exports=["$scope","SentenceWritingService","$state","_",function($scope,SentenceWritingService,$state,_){SentenceWritingService.getSentenceWriting($state.params.id).then(function(s){s.oldCategoryId=_.clone(s.categoryId),s.category=_.first(_.filter($scope.availableCategories,function(o){return o.$id==s.categoryId}));var tempList=_.chain(s.rules).pluck("ruleId").toArray().map(function(s){return String(s)}).value();s.rules=_.chain($scope.availableRules).filter(function(r){return _.contains(tempList,String(r.$id))}).map(function(r){return r.quantity=_.findWhere(s.rules,{ruleId:r.$id}).quantity,r}).value(),s.flag=_.findWhere($scope.flags,function(f){return f.$id==s.flagId}),$scope.editSentence=s})}]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/sentences/module.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.activities.sentences",[require("./../../../services/sentenceWriting.js").name]).config(require("./config.js")).controller("EditSentenceCtrl",require("./editSentence.js")).controller("SentencesCtrl",require("./controller.js"))},{"./../../../services/sentenceWriting.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/sentenceWriting.js","./config.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/sentences/config.js","./controller.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/sentences/controller.js","./editSentence.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/activities/sentences/editSentence.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/app/app.config.js":[function(require,module){"use strict";module.exports=["$urlRouterProvider","$locationProvider",function($urlRouterProvider,$locationProvider){$urlRouterProvider.otherwise("/"),$locationProvider.html5Mode({enabled:!0})}]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/app/cms/cms.config.js":[function(require,module){"use strict";module.exports=["$stateProvider",function($stateProvider){$stateProvider.state("cms",{parent:"app",url:"/cms",templateUrl:"cms.html",controller:"cms"})}]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/app/cms/cms.controller.js":[function(require,module){"use strict";module.exports=function(){}},{}],"/home/will/Clients/Quill-Grammar/src/scripts/app/cms/cms.module.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.cms",[require("./../../directives/grammarCMS").name]).config(require("./cms.config.js")).controller("cms",require("./cms.controller.js"))},{"./../../directives/grammarCMS":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/index.js","./cms.config.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/cms/cms.config.js","./cms.controller.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/cms/cms.controller.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/app/core/core.module.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.core",["ui.router",require("../../../../.tmp/config").name,require("../../../../.tmp/templates").name])},{"../../../../.tmp/config":"/home/will/Clients/Quill-Grammar/.tmp/config.js","../../../../.tmp/templates":"/home/will/Clients/Quill-Grammar/.tmp/templates.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/app/index/index.config.js":[function(require,module){"use strict";module.exports=["$stateProvider",function($stateProvider){$stateProvider.state("index",{parent:"app",url:"/",templateUrl:"index.html",controller:"index as ind"})}]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/app/index/index.controller.js":[function(require,module){"use strict";module.exports=["$scope","RuleQuestionService",function($scope,RuleQuestionService){RuleQuestionService._getAllRuleQuestionsWithInstructions().then(function(questions){var i=0;$scope.showNextQuestion=!1,$scope.showPreviousQuestion=!1,$scope.currentRuleQuestion=questions[i],$scope.nextQuestion=function(){$scope.currentRuleQuestion=questions[++i]},$scope.previousQuestion=function(){$scope.currentRuleQuestion=questions[--i]},$scope.$watch("currentRuleQuestion",function(){$scope.currentRuleQuestion||$scope.finish(),$scope.showNextQuestion=i<questions.length&&$scope.currentRuleQuestion&&$scope.currentRuleQuestion.correct,$scope.showPreviousQuestion=i>0},!0),$scope.finish=function(){console.log(i),console.log("Thanks for playing"),$scope.showNextQuestion=!1,$scope.showPreviousQuestion=!1}})}]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/app/index/index.module.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.index",[require("./../../directives/grammarElements/ruleQuestion/").name]).config(require("./index.config.js")).controller("index",require("./index.controller.js"))},{"./../../directives/grammarElements/ruleQuestion/":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarElements/ruleQuestion/index.js","./index.config.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/index/index.config.js","./index.controller.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/index/index.controller.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/app/layout/layout.config.js":[function(require,module){"use strict";module.exports=["$stateProvider",function($stateProvider){$stateProvider.state("app",{url:"","abstract":!0,templateUrl:"layout.html"})}]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/app/layout/layout.module.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.layout",[]).config(require("./layout.config.js"))},{"./layout.config.js":"/home/will/Clients/Quill-Grammar/src/scripts/app/layout/layout.config.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/categories.list.js":[function(require,module){"use strict";function categoriesList(){return{restrict:"E",templateUrl:"categories.list.html",controller:"GrammarCmsCtrl"}}module.exports=categoriesList},{}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/categories.new.js":[function(require,module){"use strict";function categoriesNew(){return{restrict:"E",templateUrl:"categories.new.html",controller:"GrammarCmsCtrl"}}module.exports=categoriesNew},{}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/category.edit.js":[function(require,module){function panel(){return{restrict:"E",scope:{category:"="},templateUrl:"category.edit.html",controller:"CategoryCtrl"}}function controller($scope,cs,rs,$q){$scope.deleteCategory=function(category){return cs.deleteCategory(category).then(function(){console.log("deleting category ",category)})},$scope.editCategory=function(category){console.log(category)},$scope.newRule=function(){$scope.showNewRuleModal=!0},$scope.showDeleteCategory=function(){$scope.showDeleteCategoryModal=!0},$scope.saveRule=function(category,rule){var d=$q.defer();return rs.saveRule(rule).then(function(ruleId){category.rules||(category.rules={}),category.rules[ruleId]=!0,cs.updateCategory(category).then(function(){category.resolvedRules||(category.resolvedRules=[]),category.resolvedRules.push(rule),$scope.category=category,d.resolve()},d.reject)},d.reject),d.promise}}module.exports.panel=panel,module.exports.controller=["$scope","CategoryService","RuleService","$q",controller]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/category.show.js":[function(require,module){"use strict";function categoryShow(){return{restrict:"E",templateUrl:"category.show.html",controller:"GrammarCmsCtrl",scope:{category:"="}}}module.exports=categoryShow},{}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/cms.controller.js":[function(require,module){"use-strict";function cmsController($scope,cs,rs){cs.getCategories().then(function(categories){$scope.categories=categories}),$scope.showRules=function(category){rs.getRules(category.rules).then(function(rules){category.resolvedRules=rules},function(e){category.error=e})},$scope.hideRules=function(category){category.resolvedRules=null},$scope.saveCategory=function(category){return cs.saveCategory(category).then(function(){console.log("Saved",category),category.title=""})},$scope.toggleCategoryModal=function(){$scope.showNewCategoryModal=!0}}module.exports=["$scope","CategoryService","RuleService",cmsController]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/index.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.directives.grammarCMS",[require("./../../services/category.js").name,require("./../../services/rule.js").name]).directive("grammarCmsCategoriesNew",require("./categories.new.js")).directive("grammarCmsCategoriesList",require("./categories.list.js")).directive("grammarCmsCategory",require("./category.show.js")).directive("grammarCmsRule",require("./rule.show.js")).directive("grammarCmsCategoryPanel",require("./category.edit.js").panel).directive("grammarCmsRulePanel",require("./rule.edit.js").panel).directive("grammarCmsRuleQuestion",require("./question.js").show).directive("grammarCmsRuleQuestionPanel",require("./question.js").panel).directive("grammarCmsModalDialog",require("./modal.js").modal).directive("grammarCmsDeleteModalDialog",require("./modal.js").deleteModal).controller("ModalDialogCtrl",require("./modal.js").controller).controller("RuleCtrl",require("./rule.edit.js").controller).controller("CategoryCtrl",require("./category.edit.js").controller).controller("QuestionCtrl",require("./question.js").controller).controller("GrammarCmsCtrl",require("./cms.controller.js"))},{"./../../services/category.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/category.js","./../../services/rule.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/rule.js","./categories.list.js":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/categories.list.js","./categories.new.js":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/categories.new.js","./category.edit.js":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/category.edit.js","./category.show.js":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/category.show.js","./cms.controller.js":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/cms.controller.js","./modal.js":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/modal.js","./question.js":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/question.js","./rule.edit.js":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/rule.edit.js","./rule.show.js":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/rule.show.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/modal.js":[function(require,module){function modal(){return{restrict:"E",scope:{show:"=",action:"="},replace:!0,transclude:!0,templateUrl:"modal.html",controller:"ModalDialogCtrl",link:function(scope){scope.hideModal=function(){scope.show=!1},scope.doAction=function(){scope.action.apply(this,arguments).then(function(){scope.hideModal()})}}}}function deleteModal(){return{restrict:"E",scope:{show:"=",onDelete:"=",item:"="},replace:!0,transclude:!0,templateUrl:"deleteModal.html",link:function(scope){scope.hideModal=function(){scope.show=!1},scope._onDelete=function(){scope.onDelete(scope.item).then(function(){scope.hideModal()},function(error){scope.error=error})}}}}function controller(){}module.exports.modal=modal,module.exports.deleteModal=deleteModal,module.exports.controller=["$scope",controller]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/question.js":[function(require,module){"use strict";function show(){return{restrict:"E",templateUrl:"question.show.html"}}function panel(){return{restrict:"E",controller:"QuestionCtrl",templateUrl:"question.edit.html"}}function controller($scope,rqs,rs){$scope.showDeleteRuleQuestion=function(){$scope.showDeleteRuleQuestionModal=!0},$scope.deleteRuleQuestion=function(question){var rule=$scope.rule;return rqs.deleteRuleQuestion(question).then(function(){return rs.removeRuleQuestionFromRule(rule,question)})}}module.exports.show=show,module.exports.panel=panel,module.exports.controller=["$scope","RuleQuestionService","RuleService",controller]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/rule.edit.js":[function(require,module){"use strict";function controller($scope,rs,rqs){$scope.deleteRule=function(){var category=$scope.category,rule=$scope.rule;return rs.deleteRule(category,rule).then(function(){$scope.rule=null},function(error){$scope.rule.error=error})},$scope.showDeleteRule=function(){$scope.showDeleteRuleModal=!0},$scope.editRule=function(rule){console.log("editing rule "+rule)},$scope.showRuleQuestionModal=function(){$scope.showNewRuleQuestionModal=!0},$scope.saveRuleQuestion=function(rule,question){return rqs.saveRuleQuestion(question).then(function(questionId){return rule.ruleQuestions||(rule.ruleQuestions={}),console.log(questionId),rule.ruleQuestions[questionId]=!0,rs.updateRule(rule)})},$scope.addAnswerToBody=function(question){question&&question.body&&question.body.push&&question.tempB&&(question.body.push(question.tempB),question.tempB=null)},$scope.question={body:[]}}function panel(){return{restrict:"E",controller:"RuleCtrl",templateUrl:"rule.edit.html"}}module.exports.controller=["$scope","RuleService","RuleQuestionService",controller],module.exports.panel=panel},{}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarCMS/rule.show.js":[function(require,module){"use strict";function ruleShow(){return{restrict:"E",templateUrl:"rule.show.html",controller:"GrammarCmsCtrl"}}module.exports=ruleShow},{}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarElements/ruleQuestion/controller.js":[function(require,module){"use strict";module.exports=function($scope,_){function removeDelimeters(b){if("string"!=typeof b)throw new Error("Input must be type string removeDelimeters");return b.replace(delim.open,"").replace(delim.close,"")}function compareEntireAnswerToBody(answer){return function(b){var cleaned=removeDelimeters(b);return answer===cleaned}}function compareGrammarElementToBody(answer){return function(b){if(!answer)return!1;var reg=new RegExp(delim.open+"(.*)"+delim.close,"g"),results=reg.exec(b),grammarElements=_.rest(results);return _.every(grammarElements,function(element){return-1!==answer.indexOf(element)})}}function setMessage(msg){$scope.ruleQuestion.message=msg}var strictTypingMode=!1,delim={open:"{",close:"}"};$scope.checkAnswer=function(){var rq=$scope.ruleQuestion,answer=rq.response,exactMatch=_.any(rq.body,compareEntireAnswerToBody(answer));if(exactMatch)return setMessage("Correct!"),void($scope.ruleQuestion.correct=!0);var grammarMatch=_.any(rq.body,compareGrammarElementToBody(answer));return grammarMatch&&!strictTypingMode?(setMessage("You are correct, but you have some typing errors. You may correct them or continue"),void($scope.ruleQuestion.correct=!0)):(grammarMatch&&setMessage("You are correct, but have some typing errors. Please fix them."),void setMessage("Try again!"))}},module.exports.$inject=["$scope","_"]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarElements/ruleQuestion/directive.js":[function(require,module){module.exports=function(){return{restrict:"E",scope:{ruleQuestion:"="},templateUrl:"ruleQuestion.html",controller:"GrammarRuleQuestionCtrl"}}},{}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarElements/ruleQuestion/filters.js":[function(require,module){"use strict";module.exports.formatPrompt=function(){return function(input){return input}},module.exports.trustedHtml=function($sce){return function(input){return $sce.trustAsHtml(input)
}},module.exports.trustedHtml.$inject=["$sce"]},{}],"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarElements/ruleQuestion/index.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.directives.ruleQuestion",[]).directive("grammarRuleQuestion",require("./directive.js")).filter("formatPrompt",require("./filters.js").formatPrompt).filter("trustedHtml",require("./filters.js").trustedHtml).controller("GrammarRuleQuestionCtrl",require("./controller.js"))},{"./controller.js":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarElements/ruleQuestion/controller.js","./directive.js":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarElements/ruleQuestion/directive.js","./filters.js":"/home/will/Clients/Quill-Grammar/src/scripts/directives/grammarElements/ruleQuestion/filters.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/services/category.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.services.category",[require("./crud.js").name]).factory("CategoryService",["CrudService","_",function(CrudService,_){var crud=new CrudService("categories",["title","rules"],"cms");return this.saveCategory=function(category){return crud.save(category)},this.deleteCategory=function(category){return crud.del(category)},this.getCategories=function(){return crud.all()},this.updateCategory=function(category){return crud.update(category)},this.removeRuleFromCategory=function(category,rule){if(!category||!category.rules)throw new Error("Category does not have any rules to remove");return _.each(category.rules,function(r,key){key===rule.$id&&(category.rules[key]=null)}),crud.update(category)},this}])},{"./crud.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/crud.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/services/classification.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.services.classification",[require("./crud.js").name]).factory("ClassificationService",["CrudService","$q",function(CrudService,$q){var crud=new CrudService("classifications",[],"cms"),cfs=this;return cfs.saveClassification=function(classification){return crud.save(classification)},cfs.deleteClassification=function(classification){return crud.del(classification)},cfs.getClassification=function(classificationId){return crud.get(classificationId)},cfs.getClassificationIdByString=function(classificationString){var d=$q.defer();return crud.all().then(function(classifications){angular.forEach(classifications,function(cl){var c=cl.$value;c.toLowerCase()===classificationString.toLowerCase()&&d.resolve(cl.$id)}),cfs.saveClassification(classificationString).then(function(id){console.log(id),d.resolve(id)},d.reject)},d.reject),d.promise},cfs}])},{"./crud.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/crud.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/services/crud.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.services.crud",["firebase","underscore"]).factory("CrudService",["firebaseUrl","$firebase","$q","_",function(firebaseUrl,$firebase,$q,_){function crud(entity,properties,prefix){function getRef(){return baseRef}function sanitize(item){return properties&&_.isObject(item)?_.pick(item,function(value,key){return"$"===key[0]||_.contains(properties,key)}):item}function save(item){var d=$q.defer(),entityItem=sanitize(item);return baseRef.$push(entityItem).then(function(ref){d.resolve(ref.key())},function(error){d.reject(error)}),d.promise}function del(item){var d=$q.defer();if(!item||!item.$id)throw new Error("Item doesn't have an $id property");return baseRef.$remove(item.$id).then(function(ref){d.resolve(ref.key())},function(error){d.reject(error)}),d.promise}function all(){var d=$q.defer(),a=baseRef.$asArray();return a.$loaded().then(function(){d.resolve(a)},function(error){d.reject(error)}),d.promise}function get(entityId){var d=$q.defer(),entityRef=new Firebase(baseRoute+"/"+entityId),entity=$firebase(entityRef).$asObject();return entity.$loaded().then(function(entityData){d.resolve(entityData)},function(error){d.reject(error)}),d.promise}function update(item){var d=$q.defer();return baseCollection.$loaded().then(function(){var index=item.$id;baseCollection[index]=sanitize(item),baseCollection.$save(index).then(function(ref){console.log(ref.key()),d.resolve(ref.key())},function(error){console.log(error),d.reject(error)})}),d.promise}if(properties||(properties=[]),"/"!==firebaseUrl[firebaseUrl.length-1]&&(firebaseUrl+="/"),!entity||""===entity)throw new Error("Firebase Entity MUST be defined");var baseUrl=String(firebaseUrl);prefix&&(baseUrl=baseUrl+prefix+"/"),console.log("Using "+baseUrl);var baseRoute=baseUrl+entity,baseRef=$firebase(new Firebase(baseRoute)),baseCollection=baseRef.$asObject();return{save:save,del:del,all:all,get:get,update:update,getRef:getRef}}return crud}])},{}],"/home/will/Clients/Quill-Grammar/src/scripts/services/indexBy.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.services.index",[require("./crud.js").name]).factory("IndexService",["firebaseUrl","$firebase",function(firebaseUrl,$firebase){function index(indexName){function getEntries(){return $firebase(new Firebase(firebaseUrl+indexName)).$asObject()}function getEntry(e){return $firebase(new Firebase(firebaseUrl+indexName+"/"+e)).$asObject()}function addElementToEntry(entry,element){return getEntry(entry).$loaded().then(function(list){return list[element]=!0,list.$save()})}function removeElementFromEntry(entry,element){return getEntry(entry).$loaded().then(function(list){return delete list[element],list.$save()})}function removeEntry(entry){return getEntries().$loaded().then(function(entries){return entries[entry]=null,entries.$save()})}function lookUpElementsForEntry(entry){return getEntry(entry)}if("/"!==firebaseUrl[firebaseUrl.length-1]&&(firebaseUrl+="/"),firebaseUrl+="indices/",!indexName||""===indexName)throw new Error("Firebase indexName MUST be defined");return{addElementToEntry:addElementToEntry,removeElementFromEntry:removeElementFromEntry,removeEntry:removeEntry,lookUpElementsForEntry:lookUpElementsForEntry}}return index}])},{"./crud.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/crud.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/services/instruction.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.services.instruction",[require("./crud.js").name]).factory("InstructionService",["CrudService",function(CrudService){var crud=new CrudService("instructions",[],"cms");return this.saveInstruction=function(instruction){return crud.save(instruction)},this.deleteInstruction=function(instruction){return crud.del(instruction)},this.getInstruction=function(instructionId){return crud.get(instructionId)},this}])},{"./crud.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/crud.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/services/rule.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.services.rule",[require("./crud.js").name,require("./ruleQuestion.js").name,require("./classification.js").name]).factory("RuleService",["CrudService","CategoryService","RuleQuestionService","$q","ClassificationService","_",function(CrudService,CategoryService,RuleQuestionService,$q,ClassificationService,_){var crud=new CrudService("rules",["title","description","ruleNumber","classification","ruleQuestions"],"cms");return this.updateRule=function(rule){return crud.update(rule)},this.saveRule=function(rule){function getClassification(rule){return ClassificationService.getClassificationIdByString(rule.classification).then(function(cid){return rule.classification=cid,rule},function(error){return error})}function addRuleNumber(rule){var ruleNumber=new CrudService("ruleNumberCounter",[],"cms").getRef();ruleNumber.$transaction(function(currentRuleNumber){if(!currentRuleNumber)return 1;if(!(0>currentRuleNumber))return currentRuleNumber+1}).then(function(snapshot){null===snapshot?d.reject(new Error("current rule number error: snapshot null")):(rule.ruleNumber=snapshot.val(),d.resolve(rule))},function(error){d.reject(error)});var d=$q.defer();return d.promise}return getClassification(rule).then(addRuleNumber).then(crud.save)},this.deleteRule=function(category,rule){return crud.del(rule).then(function(){return CategoryService.removeRuleFromCategory(category,rule)})},this.getAllRules=function(){return crud.all()},this.removeRuleQuestionFromRule=function(rule,question){if(!rule||!rule.ruleQuestions)throw new Error("rule does not have any ruleQuestions to remove");return _.each(rule.ruleQuestions,function(r,key){key===question.$id&&(rule.ruleQuestions[key]=null)}),crud.update(rule)},this.getRules=function(ruleIds){function getRuleQuestionsForRules(rules){var rqp=$q.defer(),ruleQuestionPromises=[];return angular.forEach(rules,function(rule){ruleQuestionPromises.push(RuleQuestionService.getRuleQuestions(rule.ruleQuestions))}),$q.all(ruleQuestionPromises).then(function(ruleQuestions){angular.forEach(rules,function(rule,index){rule.resolvedRuleQuestions=ruleQuestions[index]}),rqp.resolve(rules)},function(errors){rqp.reject(errors)}),rqp.promise}function getClassificationForRules(rules){var cfr=$q.defer(),cls=[];return angular.forEach(rules,function(rule){cls.push(ClassificationService.getClassification(rule.classification))}),$q.all(cls).then(function(classifications){angular.forEach(rules,function(rule,index){rule&&classifications[index]&&(rule.resolvedClassification=classifications[index])}),cfr.resolve(rules)},function(error){console.log(error),cfr.resolve(rules)}),cfr.promise}var d=$q.defer(),promises=[];return angular.forEach(ruleIds,function(value,id){promises.push(crud.get(id))}),$q.all(promises).then(getRuleQuestionsForRules).then(getClassificationForRules).then(function(rules){d.resolve(rules)},function(error){d.reject(error)}),d.promise},this}])},{"./classification.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/classification.js","./crud.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/crud.js","./ruleQuestion.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/ruleQuestion.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/services/ruleQuestion.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.services.ruleQuestion",[require("./crud.js").name,require("./instruction.js").name]).factory("RuleQuestionService",["CrudService","InstructionService","$q",function(CrudService,InstructionService,$q){function getInstructionForRuleQuestion(ruleQuestions){var insp=$q.defer(),ins=[];return angular.forEach(ruleQuestions,function(rq){ins.push(InstructionService.getInstruction(rq.instructions))}),$q.all(ins).then(function(instructions){angular.forEach(ruleQuestions,function(rq,index){rq.resolvedInstructions=instructions[index].$value}),insp.resolve(ruleQuestions)},function(errors){insp.reject(errors)}),insp.promise}var crud=new CrudService("ruleQuestions",["body","hint","instructions","prompt"],"cms");return this.saveRuleQuestion=function(ruleQuestion){return crud.save(ruleQuestion)},this.deleteRuleQuestion=function(ruleQuestion){return crud.del(ruleQuestion)},this._getAllRuleQuestionsWithInstructions=function(){return crud.all().then(getInstructionForRuleQuestion)},this.getRuleQuestions=function(ruleQuestionIds){var d=$q.defer(),promises=[];return angular.forEach(ruleQuestionIds,function(value,id){promises.push(crud.get(id))}),$q.all(promises).then(getInstructionForRuleQuestion).then(function(ruleQuestions){d.resolve(ruleQuestions)},function(error){d.reject(error)}),d.promise},this}])},{"./crud.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/crud.js","./instruction.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/instruction.js"}],"/home/will/Clients/Quill-Grammar/src/scripts/services/sentenceWriting.js":[function(require,module){"use strict";module.exports=angular.module("quill-grammar.services.sentenceWriting",[require("./crud.js").name,require("./indexBy.js").name]).factory("SentenceWritingService",["CrudService","_","IndexService",function(CrudService,_,IndexService){function checkAndFormatSentenceWritingActivity(swa){var valid=_.every(["category","flag"],function(k){return swa[k]&&swa[k].$id?(swa[k+"Id"]=swa[k].$id,!0):!1});if(!valid)throw new Error("SentenceWritingActivity did not contain category or flag");return swa.rules=_.map(swa.rules,function(r){return{ruleId:r.$id,quantity:r.quantity}}),swa}var crud=new CrudService("sentenceWritings",["flagId","categoryId","rules","title","description"],"activities"),catIndex=new IndexService("sentenceWritingsByCategory");return this.saveSentenceWriting=function(sentenceWritingActivity){var swa=checkAndFormatSentenceWritingActivity(sentenceWritingActivity);return crud.save(swa).then(function(ref){return catIndex.addElementToEntry(swa.categoryId,ref)})},this.updateSentenceWriting=function(sentenceWritingActivity){var swa=checkAndFormatSentenceWritingActivity(sentenceWritingActivity);if(!swa.oldCategoryId)throw new Error("Old Category Id not defined");return catIndex.removeElementFromEntry(swa.oldCategoryId,swa.$id).then(function(){return crud.update(swa).then(function(){return catIndex.addElementToEntry(swa.categoryId,swa.$id)})})},this.deleteSentenceWriting=function(sentenceWritingActivity){return crud.del(sentenceWritingActivity)},this.getSentenceWriting=function(sentenceWritingActivityId){return crud.get(sentenceWritingActivityId)},this.getAllSentenceWritings=function(){return crud.all()},this}])},{"./crud.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/crud.js","./indexBy.js":"/home/will/Clients/Quill-Grammar/src/scripts/services/indexBy.js"}]},{},["./src/scripts/app/app.module.js"]);